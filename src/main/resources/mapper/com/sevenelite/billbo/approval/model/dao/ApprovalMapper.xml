<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sevenelite.billbo.approval.model.dao.ApprovalMapper">

	<resultMap type="com.sevenelite.billbo.approval.model.dto.ApproDeptDTO" id="approDept">
		<id property="deptRnum" column="RNUM"/>
		<result property="deptCode" column="DEPT_CODE"/>
		<result property="deptName" column="DEPT_NAME"/>
		<result property="upper" column="DEPT_UPPER"/>
		<result property="level" column="DEPT_LEVEL"/>
		<result property="modifyDeptDate" column="MODIFY_DEPT_DATE"/>
	</resultMap>
	
	<resultMap type="com.sevenelite.billbo.approval.model.dto.ApproSpotDTO" id="approSpot">
		<id property="spotRnum" column="RNUM"/>
		<result property="spotCode" column="SPOT_CODE"/>
		<result property="spotName" column="SPOT_NAME"/>
		<result property="modifySpotDate" column="MODIFY_SPOT_DATE"/>
	</resultMap>
	
	<resultMap type="com.sevenelite.billbo.approval.model.dto.FormVacationDTO" id="vacation">
		<id property="no" column="FORM_VACATION_NO"/>
		<result property="annualType" column="ANNUAL_TYPE"/>
		<result property="startDate" column="VACATION_START"/>
		<result property="endDate" column="VACATION_END"/>
		<result property="halfDayPoint" column="HALF_DAY_POINT"/>
		<result property="annualCount" column="USED_ANNUAL_COUNT"/>
		<result property="annualReason" column="USED_ANNUAL_REASON"/>
		<result property="paymentNo" column="PAYMENT_NO"/>
		<result property="memberno" column="MEMBER_NO"/>
	</resultMap>
	
	<select id="selectLoginDept" resultMap="approDept" parameterType="_int">
        SELECT
               A.RNUM
             , A.DEPT_CODE
             , A.DEPT_NAME
             , A.DEPT_UPPER
             , A.DEPT_LEVEL
             , A.MODIFY_DEPT_DATE
        FROM (SELECT ROWNUM RNUM
                   , B.DEPT_CODE
                   , B.DEPT_NAME
                   , B.DEPT_UPPER
                   , B.DEPT_LEVEL
                   , B.MODIFY_DEPT_DATE
               FROM (SELECT C.DEPT_CODE
                          , C.DEPT_NAME
                          , C.DEPT_UPPER
                          , C.DEPT_LEVEL
                          , D.MODIFY_DEPT_DATE
                       FROM BB_DEPT C
                       JOIN BB_MODIFY_DEPT D ON(C.DEPT_CODE = D.DEPT_CODE)
                      WHERE D.MEMBER_NO = #{ memberno }
                      ORDER BY MODIFY_DEPT_DATE DESC
                    ) B 
             ) A
         WHERE RNUM = 1
	</select>
	
	<select id="selectLoginSpot" resultMap="approSpot" parameterType="_int">
        SELECT
               A.RNUM
             , A.SPOT_CODE
             , A.SPOT_NAME
             , A.MODIFY_SPOT_DATE
        FROM (SELECT ROWNUM RNUM
                   , B.SPOT_CODE
                   , B.SPOT_NAME
                   , B.MODIFY_SPOT_DATE
               FROM (SELECT C.SPOT_CODE
                          , C.SPOT_NAME
                          , D.MODIFY_SPOT_DATE
                       FROM BB_SPOT C
                       JOIN BB_MODIFY_SPOT D ON(C.SPOT_CODE = D.SPOT_CODE)
                      WHERE D.MEMBER_NO = #{ memberno }
                      ORDER BY MODIFY_SPOT_DATE DESC
                    ) B 
             ) A
         WHERE RNUM = 1
	</select>
	
	<insert id="insertVacation" parameterType="FormVacationDTO">
        INSERT 
          INTO BB_FORM_VACATION A
        (
          A.FORM_VACATION_NO, A.ANNUAL_TYPE, A.VACATION_START, A.VACATION_END, A.HALF_DAY_POINT, A.USED_ANNUAL_COUNT, A.USED_ANNUAL_REASON, A.PAYMENT_NO, A.MEMBER_NO
        ) 
		VALUES
		(
		  SEQ_VACATION_NO.NEXTVAL, #{ annualType }, #{ startDate }, #{ endDate }, #{ halfDayPoint }, #{ annualCount }, #{ annualReason }, #{ paymentNo }, #{ memberno }
		)
	</insert> 

</mapper>