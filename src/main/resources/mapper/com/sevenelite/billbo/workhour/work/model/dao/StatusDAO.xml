<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sevenelite.billbo.workhour.work.model.dao.StatusDAO">
 	<resultMap id="statusAndWorkResultMap" type="com.sevenelite.billbo.workhour.work.model.dto.StatusAndWorkDTO">
 	<id column="MEMBMER_NO" property="memNo"/>
 	<result column="WORKDATE" property="date"/>
 	<result column="COMMUTE" property="commute"/>
 	<result column="LEAVE_WORK" property="lwork"/>
 	<result column="WORKTYPE_CODE" property="type"/>
 	<result column="WORKSTATUS_NO" property="no"/>
 	<collection property="workList" resultMap="workResult"/>
 	</resultMap>	
	<resultMap id="workResult" type="com.sevenelite.billbo.workhour.work.model.dto.WorkDTO">
	<id column="WEEK_WORK_STATISTIC_NO" property="weekNo"/>
	<result column="STATISTIC_DATE" property="date"/>
	<result column="TOTAL_WORK_HOURS" property="totalWork"/>
	<result column="TOTAL_EXTRA_WORK_HOURS" property="extraWork"/>
	<result column="WORK_LATE_COUNT" property = "lateCount"/>
	<result column="WORK_COUNT" property="workCount"/>
	<result column="MEMBER_NO" property="memNo"/>
	</resultMap>
	
	<select id="selectAllStatus" resultMap="statusAndWorkResultMap">
	   SELECT
          A.WORKSTATUS_NO
        , A.WORKDATE
		, A.COMMUTE
		, A.LEAVE_WORK
	    , A.WORKTYPE_CODE
	    , B.MEMBER_NO
	    , B.WORK_LATE_COUNT
	    , B.TOTAL_EXTRA_WORK_HOURS
	 FROM BB_WORKSTATUS A
	LEFT JOIN BB_WEEK_WORK_STATISTIC B ON (A.MEMBER_NO = B.MEMBER_NO)
    ORDER BY A.WORKSTATUS_NO
	
	</select>
	
	<insert id="registWork" parameterType="StatusAndWorkDTO">
	  INSERT
	    INTO BB_WORKSTATUS A
	  (
	    A.WORKSTATUS_NO
	  , A.WORKDATE
	  , A.COMMUTE
	  , A.LEAVE_WORK
	  , A.MEMBER_NO
	  ,	A.WORKTYPE_CODE
	  )
	  VALUES
	  (
	  SEQ_WORKSTATUS_NO.NEXTVAL
	  ,  #{ date }
	  ,  SYSDATE 
	  ,  null
	  , #{ MemNo }
	  , #{ type, jdbcType=VARCHAR }
	  )	  
	</insert>
	
	<update id="updateWork" parameterType="StatusAndWorkDTO">
       UPDATE
             BB_WORKSTATUS A
          SET A.LEAVE_WORK = SYSDATE
        WHERE A.MEMBER_NO = #{ memNo }
		  AND A.WORKDATE = SYSDATE
	</update>
	
	<select id="detailWork" resultMap="statusAndWorkResultMap" parameterType="StatusAndWorkDTO">
		SELECT
		       *
          FROM BB_WORKSTATUS A
         WHERE A.WORKSTATUS_NO = #{ no }
	</select>
	<select id="seqNo" resultMap="statusAndWorkResultMap" parameterType="_int">
		SELECT 
    		SEQ_WORKSTATUS_NO.CURRVAL
       FROM DUAL
	</select>
 </mapper>   