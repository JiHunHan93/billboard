<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sevenelite.billbo.workhour.work.model.dao.WorkDAO">
	<resultMap id="workResult" type="WorkDTO">
	<id column="WEEK_WORK_STATISTIC_NO" property="weekNo"/>
	<result column="STATISTIC_DATE" property="date"/>
	<result column="TOTAL_WORK_HOURS" property="totalWork"/>
	<result column="TOTAL_EXTRA_WORK_HOURS" property="extraWork"/>
	<result column="WORK_LATE_COUNT" property = "lateCount"/>
	<result column="WORK_COUNT" property="workCount"/>
	<result column="MEMBER_NO" property="MemNo"/>
	</resultMap>
	<resultMap id="statusAndWorkResultMap" type="com.sevenelite.billbo.workhour.work.model.dto.StatusAndWorkDTO">
 	<id column="MEMBER_NO" property="MemNo"/>
 	<result column="WORKDATE" property="date"/>
 	<result column="COMMUTE" property="commute"/>
 	<result column="LEAVE_WORK" property="lwork"/>
 	<result column="WORKTYPE_CODE" property="type"/>
 	<result column="WORKSTATUS_NO" property="no"/>
 	</resultMap>
 	<resultMap id="memberResult" type="com.sevenelite.billbo.member.model.dto.MemBbDTO">
		<id property="no" column="MEMBER_NO" />
		<result property="name" column="MEMBER_NAME" />
		<result property="pwd" column="MEMBER_PWD" />
		<result property="email" column="EMAIL" />
		<result property="phone" column="PHONE" />
	</resultMap>
	<resultMap id="type" type="com.sevenelite.billbo.workhour.work.model.dto.WorkTypeDTO">
 		<id column="WORKTYPE_CODE" property="code" />
 		<result column="WORKTYPE_TYPE" property="type"/>
	</resultMap>
	
	<insert id="insertWorkInfo" parameterType="WorkDTO">
		 INSERT
		   INTO BB_WEEK_WORK_STATISTIC A
		  (
            STATISTIC_DATE 
		 ,  WEEK_WORK_STATISTIC_NO
		 ,  TOTAL_WORK_HOURS
         ,  TOTAL_EXTRA_WORK_HOURS
		 ,  WORK_LATE_COUNT
         ,  WORK_COUNT
		 )
		VALUES
		(
           SYSDATE
        ,  SEQ_WEEK_WORK_STATISTIC_NO.NEXTVAL
        ,  #{ totalWork }
        ,  #{ extraWork }
        ,  #{ LateCount }
        ,  #{ workCount }
		) 
	</insert>
	<select id="selectCommute" parameterType="StatusAndWorkDTO" resultType="String">
    SELECT
        COMMUTE
        FROM (SELECT * FROM BB_WORKSTATUS ORDER BY ROWNUM DESC) 
         WHERE ROWNUM = 1  
	</select>

	    <select id="selectLeave" parameterType="StatusAndWorkDTO" resultType="String">
       SELECT
	       C.LEAVE_WORK
	  FROM (SELECT 
	               *
	          FROM (SELECT 
	                       A.LEAVE_WORK
	                     , A.WORKDATE
	                     , A.MEMBER_NO
	                     , ROW_NUMBER() OVER (PARTITION BY A.COMMUTE ORDER BY A.WORKSTATUS_NO DESC) 날짜
	                  FROM BB_WORKSTATUS A
	               ) B 
	         WHERE 날짜 = 1
	       ) C
	 WHERE C.MEMBER_NO = #{ MemNo }  
	</select>
	
	<select id="selectWork" resultType="String" parameterType="StatusAndWorkDTO">
     SELECT
        WORKDATE 
        FROM (SELECT * FROM BB_WORKSTATUS ORDER BY ROWNUM DESC) 
         WHERE ROWNUM = 1




	</select>
	
	<update id="updateWorkCount">
     UPDATE
             BB_WEEK_WORK_STATISTIC A
		    SET A.WORK_COUNT = WORK_COUNT+1 
		  WHERE A.WEEK_WORK_STATISTIC_NO = #{ no }  
	</update>

</mapper> 
